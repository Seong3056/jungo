{% extends "base.html" %}
{% block title %}{{ listing.title }} - 채팅{% endblock %}
{% block content %}
<div class="container">
  <div class="glass" style="max-width:720px;margin:20px auto;padding:18px;border-radius:16px;">
    <h2 style="margin:0 0 10px;">💬 {{ listing.title }} 채팅</h2>
<div style="font-size:14px;color:var(--muted);margin-bottom:12px;">
  상대방:
  {% if request.user == room.buyer %}
    <strong>{{ room.seller.username }}</strong>
  {% else %}
    <strong>{{ room.buyer.username }}</strong>
  {% endif %}
</div>


    <!-- 💬 채팅 메시지 -->
    <div id="chat-box" style="max-height:420px;overflow-y:auto;padding:12px;background:rgba(255,255,255,0.1);border-radius:12px;border:1px solid rgba(255,255,255,0.25);">
      {% for msg in messages %}
        {% if msg.sender == request.user %}
          <!-- 나 -->
          <div style="text-align:right;margin-bottom:10px;">
            <div style="font-size:12px;color:var(--muted);margin-bottom:2px;">나 · {{ msg.timestamp|date:"H:i" }}</div>
            <div style="display:inline-block;background:rgba(100,100,255,0.4);color:#fff;padding:8px 12px;border-radius:12px 12px 0 12px;max-width:60%;">
              {{ msg.content|linebreaksbr }}
            </div>
          </div>
        {% else %}
          <!-- 상대방 -->
          <div style="text-align:left;margin-bottom:10px;">
            <div style="font-size:12px;color:var(--muted);margin-bottom:2px;">{{ msg.sender.username }} · {{ msg.timestamp|date:"H:i" }}</div>
            <div style="display:inline-block;background:rgba(255,255,255,0.4);padding:8px 12px;border-radius:12px 12px 12px 0;max-width:60%;">
              {{ msg.content|linebreaksbr }}
            </div>
          </div>
        {% endif %}
      {% empty %}
        <p style="color:var(--muted);">아직 대화가 없습니다.</p>
      {% endfor %}
    </div>

    <!-- 입력창 -->
    <form method="post" style="margin-top:12px;display:flex;gap:8px;">
      {% csrf_token %}
      {{ form.message }}
      <button type="submit" class="btn">전송</button>
    </form>
  </div>
</div>
{% endblock %}
